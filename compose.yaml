x-pictures-volume: &pictures-volume
  type: bind
  source: ./front/pictures/
  target: /pictures/

services:
  db:
    build: ./db/
    expose:
      - ${DB_PORT}
    ports:
      - "${DB_PORT}:${DB_PORT}"
    env_file: .env
    restart: on-failure

  api:
    build: ./api/
    expose:
      - ${API_PORT}
    ports:
      - "${API_PORT}:${API_PORT}"
    env_file: .env
    volumes:
      - <<: *pictures-volume
    depends_on:
      - db
    restart: on-failure

  front:
    build: ./front/
    ports:
      - "${FRONT_PORT}:80"
    environment:
      - API_PORT="${API_PORT}"
      - SUPERPOSABLES_SIDE="${SUPERPOSABLES_SIDE}"
      - PICTURES_DIR="${PICTURES_DIR}"
      - SUPERPOSABLES_DIR="${SUPERPOSABLES_DIR}"
    volumes:
      - <<: *pictures-volume
        target: /usr/local/apache2/htdocs/pictures/
    depends_on:
      - api
    restart: on-failure
